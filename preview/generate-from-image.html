<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Generate SVG from Lobster Image</title>
</head>
<body>
  <h1>SVG Generator</h1>
  <p>Open DevTools (F12) â†’ Console to see the SVG output.</p>
  <div id="output"></div>

  <script>
    async function generateSVG() {
      const imgUrl = "https://s3.amazonaws.com/kandipatternspatterns/misc/1763425306_lobster-perler.png";
      const cols = 21;
      const rows = 18;
      const cellSize = 20;
      const cornerRadius = 2;  // rounded corners per pixel

      const img = new Image();
      img.crossOrigin = "anonymous";
      img.src = imgUrl;
      await img.decode();

      const canvas = document.createElement("canvas");
      canvas.width = cols;
      canvas.height = rows;
      const ctx = canvas.getContext("2d");

      // resize image to grid size
      ctx.drawImage(img, 0, 0, cols, rows);
      const data = ctx.getImageData(0, 0, cols, rows).data;

      const w = cols * cellSize;
      const h = rows * cellSize;
      let svg = `<svg xmlns="http://www.w3.org/2000/svg"
     width="${w}"
     height="${h}"
     viewBox="0 0 ${w} ${h}"
     shape-rendering="crispEdges">
  <rect width="${w}" height="${h}" fill="rgb(0,0,0)"/>
`;

      for (let y = 0; y < rows; y++) {
        for (let x = 0; x < cols; x++) {
          const i = (y * cols + x) * 4;
          const r = data[i];
          const g = data[i + 1];
          const b = data[i + 2];
          const a = data[i + 3] / 255;

          if (a > 0.05) {
            svg += `
  <rect x="${x * cellSize}"
        y="${y * cellSize}"
        width="${cellSize}"
        height="${cellSize}"
        rx="${cornerRadius}"
        ry="${cornerRadius}"
        fill="rgb(${r},${g},${b})"/>`;
          }
        }
      }

      svg += "\n</svg>";
      console.log(svg);

      // Also render in page and add copy button
      document.getElementById("output").innerHTML = `
        <div style="margin: 1rem 0;">
          <button onclick="navigator.clipboard.writeText(document.getElementById('svgCode').value)">Copy SVG</button>
        </div>
        <div style="background:#f0f0f0; padding:1rem; margin:1rem 0; max-height:200px; overflow:auto;">
          ${svg}
        </div>
        <textarea id="svgCode" style="width:100%; height:200px; font-family:monospace; font-size:11px;"></textarea>
      `;
      const textarea = document.getElementById("svgCode");
      if (textarea) textarea.value = svg;
    }

    generateSVG().catch(err => {
      console.error(err);
      document.getElementById("output").innerHTML = `<p style="color:red;">Error: ${err.message}. CORS may block the image. Try running from a local server.</p>`;
    });
  </script>
</body>
</html>
